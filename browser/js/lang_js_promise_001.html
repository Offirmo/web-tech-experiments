<!DOCTYPE html>
<!-- html5_005 : html_tests micro template -->

<head>
	<meta charset="utf-8" />
	<link rel="icon" href="../assets/favicon_16x16.png" type="image/png" />
	<title>JS 001 - ES6 Promise</title>
	<style type="text/css">
		body {
			margin: 40px;
			font-family: "Lucida Sans Unicode", "Lucida Grande", sans-serif;
			color: #333;
		}
	</style>
	<script src="../../node_modules/setimmediate/setImmediate.js"></script>
</head>

<h1>...</h1>
<p>
	Testing the new ES6 Promise timings. Stuff is sent to console.
</p>

<script>
	document.querySelector('h1').textContent = document.title;
	Array.prototype.forEach.call(document.querySelectorAll('a'), function(el) {
		el.href || (el.href = el.text);
	});

	console.log('--- start ---')

	setImmediate(function() { console.log('--- immediate msg 1 ---') }, 0)
	setTimeout(function() { console.log('--- enqueued msg 1 ---') }, 0)

	const prom = new Promise(function(resolve, reject) {
		console.log('--- into Promise creation fn---')
		setImmediate(function() { console.log('--- immediate msg 2 ---') }, 0)
		setTimeout(function() { console.log('--- enqueued msg 2 ---') }, 0)
		resolve(true)
	})
	.then(function() {
		console.log('--- resolution 1 ---')
		setImmediate(function() { console.log('--- immediate msg 3 ---') }, 0)
		setTimeout(function() { console.log('--- enqueued msg 3 ---') }, 0)

	})
	.then(function() {
		console.log('--- resolution 2 ---')
		setImmediate(function() { console.log('--- immediate msg 4 ---') }, 0)
		setTimeout(function() { console.log('--- enqueued msg 4 ---') }, 0)
	})

	console.log('--- end ---')

</script>
